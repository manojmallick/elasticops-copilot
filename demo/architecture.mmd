graph TB
    subgraph Interface["üñ•Ô∏è Interface Layer"]
        UI["Copilot UI<br/>Dashboard & Home"]
        INBOX["Inbox<br/>Incidents & Tickets"]
        SEARCH["Search Explorer<br/>Hybrid Search + Explain"]
    end

    subgraph Agent["ü§ñ Agent Workflow Layer"]
        direction LR
        EMBED["1. Embed<br/>SHA-256 ‚Üí 384d Vector"]
        CLASSIFY["2. Classify<br/>Rule-Based Triage"]
        DEDUPE["3. Dedupe<br/>kNN Similarity >.95"]
        RETRIEVE_KB["4. Retrieve KB<br/>BM25 + kNN Hybrid"]
        RETRIEVE_RES["5. Retrieve Resolutions<br/>kNN Filtered Search"]
        DRAFT["6. Draft<br/>Citation-Gated Response"]
        ACT["7. Act<br/>Update / Flag / Merge"]
    end

    subgraph Elastic["‚ö° Elasticsearch Layer"]
        LOGS["logs-app<br/>ES|QL Spike Detection"]
        TICKETS["tickets<br/>BM25 + kNN"]
        KB["kb-articles<br/>Hybrid Search"]
        RES["resolutions<br/>kNN Retrieval"]
        RRF["RRF Fusion<br/>Reciprocal Rank Fusion"]
        CONF["Confidence Engine<br/>3-Component Scoring"]
        AUDIT["ops-runs / ops-metrics<br/>Audit Timeline & KPIs"]
    end

    UI --> Agent
    INBOX --> Agent
    SEARCH --> RRF

    EMBED --> CLASSIFY --> DEDUPE --> RETRIEVE_KB --> RETRIEVE_RES --> DRAFT --> ACT

    LOGS -.->|"ES|QL: error spike ‚â•40/5min"| INBOX
    DEDUPE -->|"kNN cosine similarity"| TICKETS
    RETRIEVE_KB -->|"BM25 + kNN"| KB
    RETRIEVE_RES -->|"kNN filtered"| RES
    RRF -->|"1/(k+rank) fusion"| SEARCH
    DRAFT -->|"‚â•2 citations required"| CONF
    ACT -->|"step-by-step trace"| AUDIT

    style Interface fill:#1a1a2e,stroke:#16213e,color:#e2e8f0
    style Agent fill:#0f3460,stroke:#16213e,color:#e2e8f0
    style Elastic fill:#533483,stroke:#16213e,color:#e2e8f0
    style LOGS fill:#e94560,stroke:#e94560,color:#fff
    style RRF fill:#e94560,stroke:#e94560,color:#fff
    style CONF fill:#e94560,stroke:#e94560,color:#fff
    style AUDIT fill:#e94560,stroke:#e94560,color:#fff
